<div class="min-h-screen bg-baby-pink-50 py-8">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Checkout</h1>
      <p class="mt-2 text-gray-600">Complete your order in just a few steps</p>
    </div>

    <!-- Progress Steps -->
    <div class="mb-8">
      <nav aria-label="Progress">
        <ol class="flex items-center justify-center space-x-4 md:space-x-8">
          <li *ngFor="let step of [1,2,3,4]; let i = index" class="flex items-center">
            <button
              (click)="goToStep(step)"
              [disabled]="step > currentStep"
              class="group flex items-center">
              <span
                class="flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors"
                [class.bg-primary-600]="step <= currentStep"
                [class.border-primary-600]="step <= currentStep"
                [class.text-white]="step <= currentStep"
                [class.border-gray-300]="step > currentStep"
                [class.text-gray-500]="step > currentStep">
                <svg *ngIf="step < currentStep" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <svg *ngIf="step >= currentStep" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getStepIcon(step)"/>
                </svg>
              </span>
              <span class="ml-3 text-sm font-medium hidden md:block"
                    [class.text-primary-600]="step <= currentStep"
                    [class.text-gray-500]="step > currentStep">
                {{ getStepTitle(step) }}
              </span>
            </button>
            <svg *ngIf="i < 3" class="w-5 h-5 text-gray-300 ml-4 md:ml-8" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
          </li>
        </ol>
      </nav>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Main Form Content -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow-sm p-6">

          <!-- Step 1: Shipping Information -->
          <div *ngIf="currentStep === 1">
            <h2 class="text-xl font-semibold mb-6">Shipping Information</h2>
            <form class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                  <input type="text" [(ngModel)]="shippingAddress.firstName" name="firstName" required class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                  <input type="text" [(ngModel)]="shippingAddress.lastName" name="lastName" required class="input-field w-full">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                <input type="email" [(ngModel)]="shippingAddress.email" name="email" required class="input-field w-full">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                <input type="tel" [(ngModel)]="shippingAddress.phone" name="phone" class="input-field w-full">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                <input type="text" [(ngModel)]="shippingAddress.address" name="address" required class="input-field w-full">
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                  <input type="text" [(ngModel)]="shippingAddress.city" name="city" required class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                  <select [(ngModel)]="shippingAddress.state" name="state" required class="input-field w-full">
                    <option value="">Select State</option>
                    <option value="CA">California</option>
                    <option value="NY">New York</option>
                    <option value="TX">Texas</option>
                    <!-- Add more states as needed -->
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                  <input type="text" [(ngModel)]="shippingAddress.zipCode" name="zipCode" required class="input-field w-full">
                </div>
              </div>

              <div class="flex items-center mt-6">
                <input type="checkbox" [(ngModel)]="newsletterSignup" name="newsletter" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                <label class="ml-2 text-sm text-gray-700">Sign up for our newsletter to receive exclusive offers</label>
              </div>
            </form>
          </div>

          <!-- Step 2: Billing Address -->
          <div *ngIf="currentStep === 2">
            <h2 class="text-xl font-semibold mb-6">Billing Address</h2>

            <div class="flex items-center mb-6">
              <input type="checkbox" [(ngModel)]="sameAsShipping" (change)="onSameAsShippingChange()" name="sameAsShipping" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
              <label class="ml-2 text-sm text-gray-700">Same as shipping address</label>
            </div>

            <form *ngIf="!sameAsShipping" class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                  <input type="text" [(ngModel)]="billingAddress.firstName" name="billingFirstName" required class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                  <input type="text" [(ngModel)]="billingAddress.lastName" name="billingLastName" required class="input-field w-full">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                <input type="text" [(ngModel)]="billingAddress.address" name="billingAddress" required class="input-field w-full">
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                  <input type="text" [(ngModel)]="billingAddress.city" name="billingCity" required class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                  <select [(ngModel)]="billingAddress.state" name="billingState" required class="input-field w-full">
                    <option value="">Select State</option>
                    <option value="CA">California</option>
                    <option value="NY">New York</option>
                    <option value="TX">Texas</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                  <input type="text" [(ngModel)]="billingAddress.zipCode" name="billingZip" required class="input-field w-full">
                </div>
              </div>
            </form>

            <div *ngIf="sameAsShipping" class="bg-baby-blue-50 p-4 rounded-lg">
              <p class="text-sm text-baby-blue-800">Billing address will be the same as your shipping address.</p>
            </div>
          </div>

          <!-- Step 3: Payment Method -->
          <div *ngIf="currentStep === 3">
            <h2 class="text-xl font-semibold mb-6">Payment Method</h2>

            <div class="space-y-4">
              <div class="flex items-center space-x-4 mb-6">
                <label class="flex items-center">
                  <input type="radio" [(ngModel)]="paymentMethod.type" value="card" name="paymentType" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300">
                  <span class="ml-2 text-sm text-gray-700">Credit/Debit Card</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" [(ngModel)]="paymentMethod.type" value="paypal" name="paymentType" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300">
                  <span class="ml-2 text-sm text-gray-700">PayPal</span>
                </label>
              </div>

              <form *ngIf="paymentMethod.type === 'card'" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Name on Card</label>
                  <input type="text" [(ngModel)]="paymentMethod.nameOnCard" name="nameOnCard" required class="input-field w-full">
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Card Number</label>
                  <input type="text" [(ngModel)]="paymentMethod.cardNumber" (input)="formatCardNumber($event)" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required class="input-field w-full">
                </div>

                <div class="grid grid-cols-2 gap-4">
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Month</label>
                      <select [(ngModel)]="paymentMethod.expiryMonth" name="expiryMonth" required class="input-field w-full">
                        <option value="">MM</option>
                        <option *ngFor="let month of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="month.toString().padStart(2, '0')">{{ month.toString().padStart(2, '0') }}</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Year</label>
                      <select [(ngModel)]="paymentMethod.expiryYear" name="expiryYear" required class="input-field w-full">
                        <option value="">YYYY</option>
                        <option *ngFor="let year of [2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035]" [value]="year">{{ year }}</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                    <input type="text" [(ngModel)]="paymentMethod.cvv" name="cvv" placeholder="123" maxlength="4" required class="input-field w-full">
                  </div>
                </div>
              </form>

              <div *ngIf="paymentMethod.type === 'paypal'" class="bg-blue-50 p-6 rounded-lg text-center">
                <div class="text-blue-800 mb-4">
                  <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7.076 21.337H2.47a.641.641 0 01-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 00-.607-.492c-.36-.23-.775-.38-1.23-.459 2.262-1.714 3.5-4.674 2.924-8.596C21.15-4.82 18.85-6 15.28-6H7.82C7.296-6 6.852-5.618 6.77-5.1L3.663 15.238c-.082.518.285.962.803.962h4.605c.524 0 .968-.382 1.05-.9l1.12-7.106h2.19c4.298 0 7.664-1.747 8.647-6.797.03-.149.054-.294.077-.437.023-.142.041-.285.054-.429z"/>
                  </svg>
                </div>
                <p class="text-blue-800 mb-4">You will be redirected to PayPal to complete your payment securely.</p>
              </div>
            </div>
          </div>

          <!-- Step 4: Review Order -->
          <div *ngIf="currentStep === 4">
            <h2 class="text-xl font-semibold mb-6">Review Your Order</h2>

            <!-- Order Items -->            <div class="space-y-4 mb-6">
              <div *ngFor="let item of basketItems" class="flex items-center space-x-4 py-4 border-b border-gray-200">
                <img [src]="item.product.images[0]" [alt]="item.product.name" class="w-16 h-16 object-cover rounded-lg">
                <div class="flex-1">
                  <h4 class="font-medium text-gray-900">{{ item.product.name }}</h4>
                  <p class="text-sm text-gray-600">Quantity: {{ item.quantity }}</p>
                </div>
                <div class="text-right">
                  <p class="font-medium text-gray-900">${{ item.product.price * item.quantity }}</p>
                </div>
              </div>
            </div>

            <!-- Addresses Review -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-900 mb-2">Shipping Address</h4>
                <p class="text-sm text-gray-600">
                  {{ shippingAddress.firstName }} {{ shippingAddress.lastName }}<br>
                  {{ shippingAddress.address }}<br>
                  {{ shippingAddress.city }}, {{ shippingAddress.state }} {{ shippingAddress.zipCode }}
                </p>
              </div>

              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-900 mb-2">Payment Method</h4>
                <div *ngIf="paymentMethod.type === 'card'" class="text-sm text-gray-600">
                  <p>Credit Card ending in {{ paymentMethod.cardNumber?.slice(-4) }}</p>
                  <p>{{ paymentMethod.nameOnCard }}</p>
                </div>
                <div *ngIf="paymentMethod.type === 'paypal'" class="text-sm text-gray-600">
                  <p>PayPal</p>
                </div>
              </div>
            </div>

            <!-- Terms -->
            <div class="flex items-start mb-6">
              <input type="checkbox" [(ngModel)]="termsAccepted" name="terms" required class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded mt-1">
              <label class="ml-2 text-sm text-gray-700">
                I agree to the <a href="#" class="text-primary-600 hover:text-primary-700">Terms of Service</a> and <a href="#" class="text-primary-600 hover:text-primary-700">Privacy Policy</a>
              </label>
            </div>
          </div>

          <!-- Step 5: Order Complete -->
          <div *ngIf="currentStep === 5 && orderComplete" class="text-center py-8">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Order Complete!</h2>
            <p class="text-gray-600 mb-4">Thank you for your purchase. Your order number is:</p>
            <p class="text-2xl font-bold text-primary-600 mb-6">{{ orderNumber }}</p>
            <p class="text-gray-600 mb-8">We'll send you a confirmation email with tracking information once your order ships.</p>
            <button (click)="continueShopping()" class="btn-primary">
              Continue Shopping
            </button>
          </div>

          <!-- Navigation Buttons -->
          <div *ngIf="currentStep < 5" class="flex justify-between pt-6 border-t border-gray-200">
            <button
              *ngIf="currentStep > 1"
              (click)="prevStep()"
              class="btn-secondary">
              Previous
            </button>
            <div *ngIf="currentStep === 1"></div>

            <button
              *ngIf="currentStep < 4"
              (click)="nextStep()"
              [disabled]="!validateCurrentStep()"
              class="btn-primary"
              [class.opacity-50]="!validateCurrentStep()"
              [class.cursor-not-allowed]="!validateCurrentStep()">
              Next
            </button>

            <button
              *ngIf="currentStep === 4"
              (click)="placeOrder()"
              [disabled]="processing || !termsAccepted"
              class="btn-primary flex items-center"
              [class.opacity-50]="processing || !termsAccepted"
              [class.cursor-not-allowed]="processing || !termsAccepted">
              <svg *ngIf="processing" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              {{ processing ? 'Processing...' : 'Place Order' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Order Summary Sidebar -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-sm p-6 sticky top-4">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Order Summary</h3>

          <!-- Items -->          <div class="space-y-3 mb-4">
            <div *ngFor="let item of basketItems" class="flex items-center space-x-3">
              <img [src]="item.product.images[0]" [alt]="item.product.name" class="w-12 h-12 object-cover rounded">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 truncate">{{ item.product.name }}</p>
                <p class="text-sm text-gray-500">Qty: {{ item.quantity }}</p>
              </div>
              <p class="text-sm font-medium text-gray-900">${{ item.product.price * item.quantity }}</p>
            </div>
          </div>

          <!-- Totals -->
          <div class="border-t border-gray-200 pt-4 space-y-2">
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Subtotal</span>
              <span class="text-gray-900">${{ subtotal.toFixed(2) }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Shipping</span>
              <span class="text-gray-900">${{ shipping.toFixed(2) }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Tax</span>
              <span class="text-gray-900">${{ tax.toFixed(2) }}</span>
            </div>
            <div class="border-t border-gray-200 pt-2">
              <div class="flex justify-between text-base font-medium">
                <span class="text-gray-900">Total</span>
                <span class="text-gray-900">${{ total.toFixed(2) }}</span>
              </div>
            </div>
          </div>

          <!-- Security Notice -->
          <div class="mt-6 flex items-center text-sm text-gray-500">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            Secure checkout
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
